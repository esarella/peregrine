<div class="add-photo-container">


  <div class="row">
  <%= form_for [@trip, @photo], html: {id: 'trip-dropzone', class: 'col s12 m6 offset-m3 dropzone'} do |f| %>
    <input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>" />
    <div class="fallback">
      <%= f.file_field :trip_photo, multiple: true%>
    </div>
  <% end %>
  </div>
  <div id="upload">
    <button>submit</button>
  </div>

</div>


<script>
$(document).ready(function(){
  // disable auto discover
  Dropzone.autoDiscover = false;
 
  var dropzone = new Dropzone (".dropzone", {
    paramName: "photo[trip_photo]", // Rails expects the file upload to be something like model[field_name]
    addRemoveLinks: true, // Don't show remove links on dropzone itself.
    autoProcessQueue:false,

    init: function(){
      this.on("processing", function() {
        dropzone.options.autoProcessQueue = true;
      });

      this.on("queuecomplete", function(file) {
        // this.removeFile(file)
        $.getScript("<%= new_trip_photo_url(@trip, @photo) %>")
      })
    }
  });

  $('#upload').on('click',function(e){
    e.preventDefault();
    dropzone.processQueue();  
  }); 

});
</script>